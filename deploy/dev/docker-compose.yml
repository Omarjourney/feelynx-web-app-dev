name: feelynx-dev

services:
  # Builds the Vite app and publishes the built files to a shared volume
  frontend:
    build:
      context: ../../frontend
      dockerfile: Dockerfile
    environment:
      - VITE_APP_ENV=production
    volumes:
      - frontend_dist:/dist
    depends_on:
      - backend
    restart: unless-stopped

  # Backend app served on port 8000
  backend:
    build:
      context: ../..
      dockerfile: Dockerfile.backend
    expose:
      - '8000'
    restart: unless-stopped

  # Public reverse proxy (HTTP); serves static frontend and proxies API + WebSockets
  nginx:
    image: nginx:1.25-alpine
    depends_on:
      - frontend
      - backend
    ports:
      - '80:80'
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - frontend_dist:/usr/share/nginx/html:ro
    restart: unless-stopped

volumes:
  # Where the built frontend (Vite) artifacts are published, then served by Nginx
  frontend_dist:
    driver: local
